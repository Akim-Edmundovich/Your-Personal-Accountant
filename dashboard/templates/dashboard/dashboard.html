{% extends 'base.html' %}

{% load static %}

{% block title %}Settings{% endblock %}

{% block content %}
	
	<div id="btns-in-transactions-page" style="margin-bottom: 20px">
		<button type="button" id="expense-transactions-btn"
		        style="color: white; border-radius: 5px; border: none; width:
	        100px; height: 40px; font-size: 1.2em">
			EXPENSE
		</button>
		<button type="button" id="income-transactions-btn"
		        style="color: white; border-radius: 5px; border: none; width:
	        100px; height: 40px; font-size: 1.2em">
			INCOME
		</button>
	</div>

	<button id="filter-day">День</button>
	<button id="filter-week">Неделя</button>
	<button id="filter-month">Месяц</button>
	<button id="filter-year">Год</button>
	<button id="filter-period">Период</button>
	<!-- Календарь для выбора периода -->
	<input type="date" id="start-date" style="display: none;">
	<input type="date" id="end-date" style="display: none;">

	<div id="transactions-list"></div>


	<script>
		const expenseBtn = document.getElementById('expense-transactions-btn')
		const incomeBtn = document.getElementById('income-transactions-btn')
		const transactionsList = document.getElementById('transactions-list')
		const startDateInput = document.getElementById('start-date');
		const endDateInput = document.getElementById('end-date');

		const buttons = {
			day: document.getElementById('filter-day'),
			week: document.getElementById('filter-week'),
			month: document.getElementById('filter-month'),
			year: document.getElementById('filter-year'),
			period: document.getElementById('filter-period')
		};

		expenseBtn.style.backgroundColor = 'red'
		incomeBtn.style.backgroundColor = 'black'

		buttons.period.addEventListener('click', () => {
			startDateInput.style.display = 'inline';
			endDateInput.style.display = 'inline';
		});

		loadExpensesDefault()

		expenseBtn.addEventListener('click', function () {
			loadExpensesDefault('day')

			buttons.day.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadExpenses('day')
			});
			buttons.week.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadExpenses('week')
			});
			buttons.month.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadExpenses('month')
			});
			buttons.year.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadExpenses('year')
			});

			buttons.period.addEventListener('click', () => {
				const startDate = startDateInput.value;
				const endDate = endDateInput.value;
				if (startDate && endDate) {
					loadExpenses('period', startDate, endDate);
				}
			});
		})

		incomeBtn.addEventListener('click', function () {
			loadIncomes('day')

			buttons.day.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadIncomes('day')
			});
			buttons.week.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadIncomes('week')
			});
			buttons.month.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadIncomes('month')
			});
			buttons.year.addEventListener('click', function (){
				startDateInput.style.display = 'none'
				endDateInput.style.display = 'none'
				loadIncomes('year')
			});

			buttons.period.addEventListener('click', () => {
				const startDate = startDateInput.value;
				const endDate = endDateInput.value;
				if (startDate && endDate) {
					loadIncomes('period', startDate, endDate);
				}
			});
		})


		function loadExpensesDefault() {
			axios.get(`expenses-filter-transactions/day/`)
					.then(response => {
						transactionsList.innerHTML = response.data.html
					})
					.catch(error => console.error('Ошибка:', error));
		}

		{# EXPENSES #}

		function loadExpenses(filterType, startDate = null, endDate = null) {
			const params = startDate && endDate ? {
				start_date: startDate,
				end_date: endDate
			} : {};
			axios.get(`expenses-filter-transactions/${filterType}/`, {params})
					.then(response => {
						transactionsList.innerHTML = response.data.html;
					})
					.catch(error => console.error('Ошибка:', error));
		}

		{# INCOMES #}

		function loadIncomes(filterType, startDate = null, endDate = null) {
			const params = startDate && endDate ? {
				start_date: startDate,
				end_date: endDate
			} : {};
			axios.get(`incomes-filter-transactions/${filterType}/`, {params})
					.then(response => {
						transactionsList.innerHTML = response.data.html;
					})
					.catch(error => console.error('Ошибка:', error));
		}

	</script>

{% endblock %}